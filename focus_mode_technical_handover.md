# üìò Focus Mode: Technical Handover & System Architecture
‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö "Focus Mode" ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö AI ‡∏´‡∏£‡∏∑‡∏≠ Developer ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏°‡∏≤‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠

## üèóÔ∏è 1. ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ã‡∏õ‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å (Core Concept)
Focus Mode ‡∏Ñ‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö "Lock-in" ‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (Goal) ‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏à‡∏≥‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏Å‡∏µ‡πà‡∏Ñ‡∏≥ ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏µ‡πà‡∏ß‡∏±‡∏ô ‡πÇ‡∏î‡∏¢‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏≠‡∏±‡∏•‡∏Å‡∏≠‡∏£‡∏¥‡∏ó‡∏∂‡∏° SM-2 (Spaced Repetition) ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡πâ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

### üîë ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (Key Components)
*   **Goal (‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢):** ‡∏û‡∏£‡∏∞‡πÄ‡∏≠‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏∞‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö `goal_id`
*   **Assessment (‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡∏ú‡∏•):** ‡∏°‡∏µ 3 ‡∏£‡∏∞‡∏¢‡∏∞ (Pre-Test, Interim, Post-Test)
*   **Data Isolation (‡∏ö‡∏£‡∏¥‡∏ö‡∏ó):** ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° `goal_id` ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡πà‡∏á‡∏Ñ‡∏£‡∏±‡∏î ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏ö‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠ Reset ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÇ‡∏ú‡∏•‡πà‡∏°‡∏≤‡∏õ‡∏ô‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î

---

## üöÄ 2. ‡πÄ‡∏à‡∏≤‡∏∞‡∏•‡∏∂‡∏Å User Flow & Tech Spec

### üìç Phase 1: ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (Goal Creation)
**‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á:** `CreateGoalDialog.tsx`, `useStudyGoals.ts`

**‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:**
1.  **User Input:**
    *   ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Deck (‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏•‡∏≤‡∏¢ Deck) ‚Üí `goal_deck_ids`
    *   ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡πÄ‡∏ä‡πà‡∏ô 100 ‡∏Ñ‡∏≥) ‚Üí `target_value`
    *   ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô (Duration)
    *   ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏î‡∏ß‡∏Å (Time Slots) ‚Üí ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á Sessions ‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏µ‡πâ
2.  **Database Action (`user_goals`):**
    *   Insert ‡πÅ‡∏ñ‡∏ß‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á `user_goals`
    *   **‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:** `status` = 'active', `current_value` = 0
3.  **Result:** ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏∞‡πÑ‡∏î‡πâ `activeGoal` ‡πÉ‡∏´‡∏°‡πà ‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤ Dashboard ‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏õ‡πá‡∏ô Focus Mode Journey Map

---

### üìç Phase 2: Pre-Test (‡∏à‡∏∏‡∏î‡∏ß‡∏±‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô)
**‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á:** `PreTestPage.tsx`, `useAssessment.ts`, `PreTestResultsPage.tsx`

#### A. ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥ (Before Pre-Test):
*   **Dashboard:**
    *   ‡∏Å‡∏≤‡∏£‡πå‡∏î "Pre-Test" ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏° **Start** (‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á/‡πÅ‡∏î‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà‡πÄ‡∏ß‡∏•‡∏≤)
    *   ‡∏Å‡∏≤‡∏£‡πå‡∏î "Session 1" (‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏£‡∏¥‡∏á) ‡∏à‡∏∞ **Locked** (‡∏Å‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ) ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏∂‡πâ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ "Waiting"
    *   ‡∏Å‡∏≤‡∏£‡πå‡∏î "Tests History" (‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥) ‡∏Å‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏à‡∏∞ **‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤**

#### B. ‡∏Ç‡∏ì‡∏∞‡∏ó‡∏≥ (During Pre-Test):
*   **Logic ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:**
    *   **> 60 ‡∏Ñ‡∏≥:** User ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏™‡∏≠‡∏ö "Quick" (60 ‡∏Ñ‡∏≥) ‡∏´‡∏£‡∏∑‡∏≠ "Full" (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
    *   **<= 60 ‡∏Ñ‡∏≥:** ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
*   **Logic ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:** ‡∏™‡∏∏‡πà‡∏° Flashcard ‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á
*   **Logic ‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö:** 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ/‡∏Ç‡πâ‡∏≠ (Speed Test)

#### C. ‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à (After Pre-Test): üåü ‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏≠‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å 3 ‡∏™‡πà‡∏ß‡∏ô (‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î):
1.  **`user_flashcard_progress`:**
    *   **‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å:** `srs_level` = 3 (‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏à‡∏≥‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß), `next_review` = +7 ‡∏ß‡∏±‡∏ô
    *   **‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î:** `srs_level` = 0 (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà), `next_review` = ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
2.  **`practice_sessions` (Log ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô):**
    *   `session_mode`: **'pre-test'** (‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ 'pretest' ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏µ‡∏î! - ‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß)
    *   `deck_id`: **NULL** (‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ ‡∏´‡πâ‡∏≤‡∏°‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ß‡πà‡∏≤‡∏á ‡πÑ‡∏°‡πà‡∏á‡∏±‡πâ‡∏ô DB Error)
    *   `goal_id`: ‡πÉ‡∏™‡πà `goal_id` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
3.  **`goal_assessments` (‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô):**
    *   `assessment_type`: **'pre-test'** (‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Enum)
    *   `user_id`: **USER_ID** (‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ RLS ‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô)

**‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏´‡∏•‡∏±‡∏á‡∏™‡∏≠‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à:**
*   **Pre-Test Results Page:** ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏£‡∏∏‡∏õ -> ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "Continue Focus Mode"
*   **Dashboard (‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å):**
    *   ‡∏Å‡∏≤‡∏£‡πå‡∏î "Pre-Test" ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô **‡∏ï‡∏¥‡πä‡∏Å‡∏ñ‡∏π‡∏Å‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß** (Completed) ‚úÖ
    *   ‡∏Å‡∏≤‡∏£‡πå‡∏î "Session 1" **‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ** (Button Active) ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏Å‡∏î Start ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    *   ‡∏Å‡∏≤‡∏£‡πå‡∏î "Tests History" ‡∏Å‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏à‡∏∞‡πÄ‡∏à‡∏≠ **‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö Pre-Test** ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏ó‡∏≥‡πÑ‡∏õ (‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° Goal ID ‡∏ô‡∏±‡πâ‡∏ô‡πÜ)

---

### üìç Phase 3: Daily Learning Loop (‡∏Å‡∏¥‡∏à‡∏ß‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô)
**‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á:** `TodaySchedule.tsx`

**Logic ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (UI):**
*   ‡πÇ‡∏´‡∏•‡∏î Sessions ‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏≤‡∏Å `activeGoal.time_slots`
*   **‡∏õ‡∏∏‡πà‡∏° Start:**
    *   **‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** ‡∏à‡∏∞ Active ‡∏Å‡πá‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤ (Time-Gating) ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏¢‡πÄ‡∏ß‡∏•‡∏≤‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß
    *   **‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç:** ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥ Pre-Test ‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô (‡πÄ‡∏ä‡πá‡∏Ñ `practice_sessions` state)
    *   **Action:** ‡∏Å‡∏î‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ `FlashcardGame` ‡∏û‡∏£‡πâ‡∏≠‡∏° parameter `mode=focus`

**‡∏õ‡∏∏‡πà‡∏° Bonus Mode:**
*   **‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç:** ‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡πÄ‡∏°‡∏∑‡πà‡∏≠ "‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏£‡∏ö‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤" ‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß
*   **‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:** ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£ "‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©"
*   **‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô XP ‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö Schedule ‡∏´‡∏•‡∏±‡∏Å (Optional)

---

### üìç Phase 4: Interim Test (‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≤‡∏á)
**‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á:** `InterimTestPage.tsx`

**‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?** ‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡∏ß‡∏±‡∏î‡∏ú‡∏•‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞ "Reset" ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏à‡∏≥‡∏ú‡∏¥‡∏î
**‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠:**
*   ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏±‡πâ‡∏ô (< 14 ‡∏ß‡∏±‡∏ô): ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 3, 6, 9
*   ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏¢‡∏≤‡∏ß: ‡∏ó‡∏∏‡∏Å‡πÜ 7 ‡∏ß‡∏±‡∏ô (Day 7, 14, 21...)

**Logic ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:**
*   **60%:** ‡∏°‡∏≤‡∏à‡∏≤‡∏Å "Risk Words" (‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î‡∏ö‡πà‡∏≠‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠ `srs_level` ‡∏ï‡πà‡∏≥) - ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô
*   **40%:** ‡∏™‡∏∏‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß (Review) - ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏•‡∏∑‡∏°

---

### üìç Phase 5: Post-Test (‡∏™‡∏≠‡∏ö‡∏õ‡∏¥‡∏î‡∏à‡πá‡∏≠‡∏ö)
**‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á:** `PostTestPage.tsx`

**‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç:** ‡∏ß‡∏±‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á Goal
**Logic ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:**
*   **Mode "Re-test":** ‡∏™‡∏≠‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà "‡∏£‡∏π‡πâ‡πÅ‡∏•‡πâ‡∏ß" ‡∏à‡∏≤‡∏Å Pre-Test ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏î‡∏ß‡πà‡∏≤‡∏¢‡∏±‡∏á‡∏à‡∏≥‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏° (Retention Rate)
*   **Mode "All":** ‡∏™‡∏≠‡∏ö‡πÅ‡∏°‡πà‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏•‡∏¢
**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
*   ‡∏ñ‡πâ‡∏≤‡∏™‡∏≠‡∏ö‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå ‚Üí `user_goals.is_completed = true`
*   ‡πÑ‡∏î‡πâ Certificate (‡∏´‡∏ô‡πâ‡∏≤ Victory)

---

## üîß 3. Technical Issues & Fixes (‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°)

### üî¥ ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô (History Missing)
*   **‡∏≠‡∏≤‡∏Å‡∏≤‡∏£:** ‡∏™‡∏≠‡∏ö Pre-Test ‡πÄ‡∏™‡∏£‡πá‡∏à ‡∏ï‡∏¥‡πä‡∏Å‡∏ñ‡∏π‡∏Å‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß ‡πÅ‡∏ï‡πà‡∏Å‡∏î‡∏î‡∏π "Tests" ‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤
*   **‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:** 
    1. ‡∏™‡πà‡∏á‡∏™‡∏ï‡∏£‡∏¥‡∏á `pretest` ‡πÑ‡∏õ ‡πÅ‡∏ï‡πà DB ‡∏£‡∏≠‡∏£‡∏±‡∏ö `pre-test` (Type/Enum mismatch)
    2. ‡∏•‡∏∑‡∏°‡∏™‡πà‡∏á `deck_id` ‡πÑ‡∏õ‡πÉ‡∏ô `practice_sessions` (Column constraint)
    3. `TodaySchedule` ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ Re-fetch ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Goal (Stale dependency)
*   **‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ (‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô):** 
    *   ‡πÅ‡∏Å‡πâ String ‡πÄ‡∏õ‡πá‡∏ô `pre-test` ‡∏ó‡∏∏‡∏Å‡∏à‡∏∏‡∏î
    *   ‡πÉ‡∏™‡πà `deck_id: null`
    *   ‡πÉ‡∏™‡πà `user_id` Explicitly
    *   ‡πÅ‡∏Å‡πâ `useEffect` dependency ‡πÄ‡∏õ‡πá‡∏ô `[activeGoal.id]`

### üî¥ ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Isolation (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏ô‡∏Å‡∏±‡∏ô)
*   **‡∏≠‡∏≤‡∏Å‡∏≤‡∏£:** ‡∏™‡∏£‡πâ‡∏≤‡∏á Goal ‡πÉ‡∏´‡∏°‡πà ‡πÅ‡∏ï‡πà‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á Goal ‡πÄ‡∏Å‡πà‡∏≤
*   **‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:** ‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ `goal_id` ‡πÄ‡∏õ‡πá‡∏ô Filter ‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å Query (`.eq('goal_id', activeGoal.id)`) ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ DateRange ‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÑ‡∏°‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥

---

## üíæ 4. Database Schema Reference

### `user_goals` (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢)
*   **id (uuid):** Primary Key
*   **current_value (int):** ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß (Progress)
*   **target_value (int):** ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
*   **status (text):** ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ('active', 'completed', 'dropped')

### `goal_assessments` (‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö)
*   **goal_id (uuid):** Foreign Key ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö user_goals (‡∏ï‡∏±‡∏ß‡πÅ‡∏ö‡πà‡∏á‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
*   **assessment_type (text):** ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö (**'pre-test'**, 'interim', 'post-test')
*   **score (int):** ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏î‡∏¥‡∏ö
*   **accuracy (float):** % ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô

### `practice_sessions` (Log ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)
*   **session_mode (text):** ‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (**'pre-test'**, 'interim', 'focus')
*   **deck_id (uuid):** ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô NULL (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Goal-based session)
*   **goal_id (uuid):** Foreign Key ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö Goal

---

## üì¢ 5. ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö AI ‡∏Ñ‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ
*   **‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Enum:** `pre-test` ‡∏Ñ‡∏∑‡∏≠ `pre-test` (‡∏°‡∏µ‡∏Ç‡∏µ‡∏î) ‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏ú‡∏•‡∏≠‡πÑ‡∏õ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å
*   **Deck ID:** ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á Goal ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á `null` ‡πÑ‡∏õ‡πÄ‡∏™‡∏°‡∏≠ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ Goal ‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢ Deck
*   **User ID:** ‡πÉ‡∏™‡πà‡πÄ‡∏™‡∏°‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ç‡∏≠‡∏á RLS
*   **Focus Mode Logic:** ‡∏°‡∏±‡∏ô‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏ó‡∏µ‡πà State (Day 1 vs Day N), ‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏Å‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏´‡πâ‡∏î‡∏π `setupDailySession` ‡πÉ‡∏ô `useSM2FocusMode.ts` ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å
